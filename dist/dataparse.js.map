{"version":3,"sources":["../src/dataparse.js"],"names":["DataParser","data","MediaError","Error","console","info","target","_embedded","stream","_links","self","id","result","addObject","key","value","time","val","push","results","forEach","Date","d","t","getTime","v","p","coordinates","ret","_","map","collection","data2","addValue","name","timevalue","error"],"mappings":"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","file":"dataparse.js","sourcesContent":["\nexport class DataParser {\n    constructor() {\n\n    }\n\n    parseCsvData(data) {\n        if (typeof data != 'string')\n            throw new MediaError('expected string, got ' + typeof data);\n\n        throw new Error('nyi');\n    }\n\n    parseDataSingle(data) {\n        console.info(\"DataParser.parseDataSingle\");\n\n        /* var parseobj = obj => {\n             return [obj.v.v, new Date(obj.t).getTime()];\n         }*/\n\n        var target = data._embedded.stream._links.self.id;\n\n        var result = {};\n\n        var addObject = (key, value, time) => {\n            if (!(key in result))\n                result[key] = [];\n\n            var val = [value, time];\n            result[key].push(val);\n        }\n\n\n        data.results.forEach(d => {\n            var time = new Date(d.t).getTime();\n\n            if ('v' in d) {\n                if ('v' in d.v) {\n                    addObject(target, d.v.v, time);\n                }\n                else if ('p' in d.v) {\n                    addObject(target + \".X\", d.v.p.coordinates[0], time);\n                    addObject(target + \".Y\", d.v.p.coordinates[1], time);\n                    addObject(target + \".Z\", d.v.p.coordinates[2], time);\n                }\n            }\n        });\n\n        var ret = _.map(result, (value, key, collection) => {\n            return {\n                \"target\": key,\n                \"datapoints\": value\n            }\n        });\n\n        return ret;\n    }\n\n    parseData(data) {\n        console.info(\"DataParser.parseData\");\n        var data2 = {};\n\n        var addValue = (name, value, timevalue) => {\n            if (!(name in data2)) {\n                console.error('adding: ' + name);\n                data2[name] = [];\n            }\n            var val = [value, timevalue];\n            data2[name].push(val);\n        }\n\n        data.results.forEach(d => {\n            var time;\n            for (time in d) { break; }\n\n            var timevalue = new Date(time).getTime();\n\n            for (var key in d[time]) {\n\n                if ('v' in d[time][key]) {\n                    addValue(key, d[time][key].v, timevalue);\n                }\n                else if ('p' in d[time][key]) {\n                    addValue(key + \".X\", d[time][key].p.coordinates[0], timevalue);\n                    addValue(key + \".Y\", d[time][key].p.coordinates[1], timevalue);\n                    addValue(key + \".Z\", d[time][key].p.coordinates[2], timevalue);\n                }\n\n            }\n        });\n\n        return _.map(data2, (value, key, collection) => {\n            return { \"target\": key, \"datapoints\": value }\n        });\n    }\n\n}\n"]}